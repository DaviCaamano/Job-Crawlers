// ==UserScript==
// @name         Quick Paste
// @namespace    http://tampermonkey.net/
// @version      2026-02-10
// @description  try to take over the world!
// @author       You
// @match        *://*/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=chatgpt.com
// @grant        GM_setValue
// @grant        GM_getValue
// ==/UserScript==

(function() {
    'use strict';
    const coverLetter = `Hiring Manager,
With over six years of experience designing and deploying scalable full-stack
applications within the typescript/node ecosystem of frameworks, I bring a strong
blend of technical depth, leadership, and collaborative problem-solving to every
project.
In my recent roles at Orsini IT, ShiftPixy and LegitScript, I built and maintained
complex web applications leveraging the Node.Js ecosystem of frameworks including:
React.Js, Next.js, Angular.Js, Nest.js, React Native.Js (Mobile) and Node.Js itself
hosted on AWS Lambda serverless instances.
For Orisini IT and Shift Pixy, I started my position in entry level roles (intern/Jr.
Developer respectively) and in less than six months I was elevated to the position of
team lead due to my habit of taking widespread ownership of the projects I work on,
my serious commitment to facilitate communication across team members and subteams, and my eagerness at which I tend to take initiative.
Thank you for considering my application. I’d love the opportunity to discuss how my
technical expertise and leadership experience can help drive success in this role.
Sincerely,
Davi Caamano
(786) 879 - 0802 `
    const hotKeys = {
        '0': 'DaviSantaCaamano@gmail.com',
        '1': 'Davi',
        '2': 'Caamano',
        '3': '7868790802',
        '4': '12933 sw 210 terrace',
        '5': 'Miami',
        '6': '33177',
        '7': 'https://www.linkedin.com/in/davi-caamano-8a440b157/',
        '8': 'https://DaviCaamano.com/',
        '9': 'https://github.com/DaviCaamano',
        'shift': {
            '0': '',
            '1': 'Santa',
            '2': '',
            '3': '',
            '4': '12933 sw 210 terrace, Miami FL, 33177',
            '5': 'Florida',
            '6': 'FL',
            '7': coverLetter,
            '8': '',
            '9': '',
        },
        'ctrl':  {
            '0': '',
            '1': '',
            '2': '',
            '3': '',
            '4': '',
            '5': '',
            '6': '',
            '7': '',
            '8': '',
            '9': '',
        }
    }
    const LOCAL_STORAGE_KEY = 'tamper-monkey-quick-paste';
    const LOCAL_DATA_DEFAULT = { enabled: true };
    let enabled = GM_getValue(LOCAL_STORAGE_KEY, LOCAL_DATA_DEFAULT).enabled;

    const describeHotKeys = () => {
        let description = 'Short Cuts:<br />Enable: Ctrl -<br />';
        let first = true;
        for(let key in hotKeys){
            if(first){
                first = false;
            }
            description += `${key}: ${hotKeys[key]}<br />`;
        }
        return description;
    }
    let toastElement;

    // Raise a on-screen message (toast)
    const toast = (msg, ms = 2000) => {
        console.log('toast:', msg);
        toastElement?.remove();
        toastElement = document.createElement("div");
        toastElement.innerHTML = msg;
        Object.assign(toastElement.style, {
            position: "fixed",
            top: '400px',
            left: "50%",
            transform: "translate(-50%, -50%)",
            padding: "20px 24px",
            borderRadius: "8px",
            background: "rgba(0,0,0,0.85)",
            color: "white",
            fontSize: "36px",
            zIndex: 999999,
            maxWidth: "40vw",
            lineHeight: "1.3",
        });
        document.body.appendChild(toastElement);
        setTimeout(() => toastElement.remove(), ms);
    }

    const insertText = (text, el) => {
        const setNativeValue = (element, value) => {
            // Helps frameworks like React detect the change reliably
            const proto = element.tagName === "TEXTAREA"
            ? HTMLTextAreaElement.prototype
            : HTMLInputElement.prototype;

            const valueSetter = Object.getOwnPropertyDescriptor(proto, "value")?.set;
            valueSetter ? valueSetter.call(element, value) : (element.value = value);
        };

        const safeGetSelection = (element) => {
            // Some input types (e.g. email) can throw when reading selectionStart/End
            let start, end;
            try {
                start = element.selectionStart;
                end = element.selectionEnd;
            } catch {
                start = null;
                end = null;
            }
            return { start, end };
        };

        // INPUT / TEXTAREA
        if (el.tagName === "INPUT" || el.tagName === "TEXTAREA") {
            el.focus();

            const { start, end } = safeGetSelection(el);
            const hasSelection = typeof start === "number" && typeof end === "number";

            // Best path (works for text-like inputs)
            if (hasSelection && typeof el.setRangeText === "function") {
                try {
                    el.setRangeText(text, start, end, "end");
                } catch (err) {
                    // Fallback for types like email where setRangeText can throw
                    const cur = el.value ?? "";
                    const next = cur + text;
                    setNativeValue(el, next);
                }
            } else {
                // Fallback (email, number, etc.) — append or replace whole value logic
                const cur = el.value ?? "";
                // If selection info exists, insert at caret; otherwise append.
                const next = hasSelection
                ? cur.slice(0, start) + text + cur.slice(end)
                : cur + text;

                setNativeValue(el, next);

                // Try to restore caret if the browser supports it (won’t on email)
                if (hasSelection) {
                    const pos = start + text.length;
                    try {
                        el.setSelectionRange(pos, pos);
                    } catch {
                        // ignore
                    }
                }
            }

            // Trigger frameworks (React/Vue/etc)
            el.dispatchEvent(new Event("input", { bubbles: true }));
            el.dispatchEvent(new Event("change", { bubbles: true }));
            return;
        }

        // contenteditable
        if (el.isContentEditable) {
            el.focus();
            const sel = window.getSelection();
            if (!sel) return;

            if (sel.rangeCount === 0) {
                el.appendChild(document.createTextNode(text));
            } else {
                const range = sel.getRangeAt(0);
                range.deleteContents();
                range.insertNode(document.createTextNode(text));

                // Move caret after inserted text
                range.setStart(range.endContainer, range.endOffset);
                range.collapse(true);
                sel.removeAllRanges();
                sel.addRange(range);
            }

            el.dispatchEvent(new Event("input", { bubbles: true }));
        }
    };

    window.addEventListener(
        "keydown",
        (e) => {
            if(e?.ctrlKey && e?.key === '-'){
                if(enabled) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                toast(enabled ? 'Disabling Quick Paste' : 'Enabling Quick Paste', 10000);
                enabled = !enabled;
                GM_setValue(LOCAL_STORAGE_KEY, { enabled });
                return;
            }
            if(!enabled){
                return;
            }
            if(e?.ctrlKey && e?.key === '/'){
                toast(describeHotKeys(), 10000);
                return;
            }
            const el = document.activeElement;
            if (!el || !e.code.startsWith('Numpad')) return;

            const isTextInput =
                  (el.tagName === "INPUT" &&
                   !["button", "checkbox", "color", "file", "hidden", "image", "radio", "range", "reset", "submit"].includes(
                      (el.getAttribute("type") || "text").toLowerCase()
                  )) ||
                  el.tagName === "TEXTAREA" ||
                  el.isContentEditable;

            if (!isTextInput) return;
            e.preventDefault();
            e.stopPropagation();

            const key = e?.key;
            console.log('key', key)


            if(/^[0-9]$/.test(key)){
                if(e.shiftKey){
                    if(!!hotKeys.shift[key]){
                        insertText(hotKeys.shift[key], el);
                    }
                } if(e.ctrlKey){
                    if(!!hotKeys.ctrl[key]){
                        insertText(hotKeys.ctrl[key], el);
                    }
                } else if(!!hotKeys[key]){
                    insertText(hotKeys[key], el);
                }
            }
        },
        true // capture helps on sites that stopPropagation
    );

})();